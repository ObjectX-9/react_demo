import{r as p,R as u}from"./index-BBkUAzwr.js";const j="_fixedHeightContainer_1dpmb_1",q="_contentContainer_1dpmb_8",G="_uncertainHeightContainer_1dpmb_11",J="_childContainer_1dpmb_21",R={fixedHeightContainer:j,contentContainer:q,uncertainHeightContainer:G,childContainer:J},T=a=>{const{childHeight:d=50,childIndex:c,itemStyle:h}=a;return u.createElement("div",{className:R.childContainer,style:h??{position:"absolute",height:d,top:d*c},key:`${c}${h==null?void 0:h.height}`},h?u.createElement("span",null,"序号",c+1," 高度：",h.height," top偏移：",h.top):u.createElement("span",null,c+1," "))},K=a=>{const{itemHeight:d=50,itemSumCount:c=1e3,listWidth:h,listHeight:f}=a,[I,m]=p.useState(0),g={position:"relative",width:h??400,height:f??600},b={height:d*c,width:"100%"},y=x=>{const{itemHeight:H=50,itemSumCount:v=1e3,listHeight:w=600}=x,E=Math.floor(I/H),r=Math.max(0,E-2),s=Math.ceil(w/H),e=Math.min(v,E+s+2),n=[];for(let t=r;t<e;t++)n.push(T({childHeight:H,childIndex:t}));return n},M=x=>{const{scrollTop:H}=x.currentTarget;m(H)};return u.createElement("div",{className:R.fixedHeightContainer,style:g,onScroll:M},u.createElement("div",{className:R.contentContainer,style:b},y(a)))},P=a=>{const{itemHeight:d=50,itemSumCount:c=1e3,listWidth:h=400,listHeight:f=600}=a,I=p.useRef(new Array(c).fill(0).map(()=>d+Math.round(Math.random()*d))),m=e=>I.current[e],g={measuredDataMap:[],LastMeasuredItemIndex:-1},b=(e=50,n)=>{let t=0;const{measuredDataMap:o,LastMeasuredItemIndex:i}=g;if(i>=0){const S=o[i];t=S.topOffset+S.height}const l=n-g.LastMeasuredItemIndex-1;return t+l*e},y=e=>{const{measuredDataMap:n,LastMeasuredItemIndex:t}=g;if(e>t){let o=0;if(t>=0){const i=n[t];o+=i.topOffset+i.height}for(let i=t+1;i<=e;i++){const l=m(i);n[i]={height:l,topOffset:o},o+=l}g.LastMeasuredItemIndex=e}return n[e]},M=(e,n)=>{const{itemSumCount:t=1e3}=e;let o=0,i=t-1;for(;o<=i;){const l=Math.floor((o+i)/2),C=y(l).topOffset;if(C===n)return l;C<n?o=l+1:i=l-1}return o},x=(e,n)=>{const{listHeight:t=600,itemSumCount:o=1e3}=e,i=y(n),l=i.topOffset+t;let C=i.topOffset+i.height,S=n;for(;C<=l&&S<o-1;){S++;const F=y(S);C+=F.height}return S},H=(e,n)=>{const{itemSumCount:t=1e3,bufferNum:o=4}=e,i=M(e,n),l=x(e,i);return{bufferStartIndex:Math.max(0,i-o),bufferEndIndex:Math.min(t-1,l+o),startIndex:i,endIndex:l}},v=(e,n)=>{const t=[],{bufferStartIndex:o,bufferEndIndex:i}=H(e,n);for(let l=o;l<=i;l++){const C=y(l),S={position:"absolute",height:C.height,width:"100%",top:C.topOffset};t.push(u.createElement(T,{key:l,childIndex:l,itemStyle:S}))}return console.log("✅ ~ measuredData:",g),t},w={position:"relative",width:h,height:f,overflow:"auto",boxSizing:"border-box"},E={height:b(d,c),width:"100%",boxSizing:"border-box"},[r,s]=p.useState(0);return p.useEffect(()=>{const e=document.querySelector(".uncertainHeightContainer");if(e){const n=t=>{const o=t.target;s(o.scrollTop)};return e.addEventListener("scroll",n),()=>{e.removeEventListener("scroll",n)}}},[]),u.createElement("div",{className:"mainContainer"},u.createElement("div",{className:"srcollNum"},"已经滚动了：",Math.floor(r)),u.createElement("div",{className:"uncertainHeightContainer",style:w},u.createElement("div",{className:"contentContainer",style:E},v(a,r))))},Q=(()=>{let a=null;return()=>{if(a)return a;a=[];const d=1e3;for(let c=0;c<d;c++){const f={height:30+Math.floor(Math.random()*30),width:"100%"};a.push(u.createElement(T,{key:c,childIndex:c,itemStyle:f}))}return a}})(),X=a=>{const{itemStyle:d,getChildItem:c,onSizeChange:h,childIndex:f}=a,I=p.useRef(null),m=p.useRef(null);return p.useEffect(()=>{const g=I.current;return g&&(m.current||(m.current=new ResizeObserver(()=>{h(f,g)})),m.current.observe(g)),()=>{m.current&&g&&m.current.unobserve(g)}},[f,h]),u.createElement("div",{ref:I,style:d},c(f))},Y=a=>Q()[a],L={measuredDataMap:[],LastMeasuredItemIndex:-1},Z=({itemSumCount:a=1e3,listWidth:d=400,listHeight:c=600,itemHeight:h=50})=>{const f=(r,s)=>{const e=s.children[0].offsetHeight,{measuredDataMap:n,LastMeasuredItemIndex:t}=L;n[r].height=e;let o=0;for(let i=0;i<=t;i++)n[i].topOffset=o,o+=n[i].height;s.style.height=e+"px",E(!0)},I=(r,s)=>{let e=0;const{measuredDataMap:n,LastMeasuredItemIndex:t}=L;return t>=0&&(e=n[t].topOffset+n[t].height),e+(s-t-1)*r},m=r=>{const{measuredDataMap:s,LastMeasuredItemIndex:e}=L;if(r>e){let n=e>=0?s[e].topOffset+s[e].height:0;for(let t=e+1;t<=r;t++)s[t]={height:50,topOffset:n},n+=50;L.LastMeasuredItemIndex=r}return s[r]},g=r=>{let s=0,e=a-1;for(;s<=e;){const n=Math.floor((s+e)/2),t=m(n).topOffset;if(t===r)return n;t<r?s=n+1:e=n-1}return s},b=r=>{const s=m(r),e=s.topOffset+c;let n=s.topOffset+s.height,t=r;for(;n<=e&&t<a-1;)t++,n+=m(t).height;return t},y=r=>{const e=g(r),n=b(e);return{bufferStartIndex:Math.max(0,e-4),bufferEndIndex:Math.min(a-1,n+4),startIndex:e,endIndex:n}},M=r=>{const s=[],{bufferStartIndex:e,bufferEndIndex:n}=y(r);for(let t=e;t<=n;t++){const o=m(t),i={position:"absolute",height:o.height,width:"100%",top:o.topOffset};s.push(u.createElement(X,{key:`${t}${o.topOffset}`,childIndex:t,getChildItem:Y,onSizeChange:f,itemStyle:i}))}return s},x=p.useRef(null),[H,v]=p.useState(0),[w,E]=p.useState(!1);return console.log("✅ ~ needUpdate:",w),p.useEffect(()=>{if(!x.current)return;const r=x.current;if(r){const s=e=>{v(e.target.scrollTop)};return r.addEventListener("scroll",s),()=>{r.removeEventListener("scroll",s)}}},[]),u.createElement("div",{className:"mainContainer"},u.createElement("div",{className:"scrollNum"},"已经滚动了：",Math.floor(H)),u.createElement("div",{className:"dynamicHeightContainer",ref:x,style:{position:"relative",width:d,height:c,overflow:"auto",boxSizing:"border-box"}},u.createElement("div",{className:"contentContainer",style:{height:I(h,a),width:"100%",boxSizing:"border-box"}},M(H))))},ee={uncertainHeight:P,fixedHeight:K,dynamicHeight:Z},te=({virtualListType:a="fixedHeight",itemHeight:d,itemSumCount:c,listWidth:h,listHeight:f,bufferNum:I,...m})=>ee[a]({itemHeight:d,itemSumCount:c,listWidth:h,listHeight:f}),ie={title:"通用/VirtualList虚拟列表",component:te,parameters:{layout:"centered"},tags:["autodocs"],argTypes:{}},O={args:{virtualListType:"uncertainHeight",listWidth:400,listHeight:600,itemHeight:50,itemSumCount:1e3}},D={args:{virtualListType:"fixedHeight",listWidth:400,listHeight:600,itemHeight:50,itemSumCount:1e3}},N={args:{virtualListType:"dynamicHeight",listWidth:400,listHeight:600,itemHeight:50,itemSumCount:1e3}};var _,z,W;O.parameters={...O.parameters,docs:{...(_=O.parameters)==null?void 0:_.docs,source:{originalSource:`{
  args: {
    virtualListType: 'uncertainHeight',
    listWidth: 400,
    listHeight: 600,
    // 预测高度
    itemHeight: 50,
    itemSumCount: 1000
  }
}`,...(W=(z=O.parameters)==null?void 0:z.docs)==null?void 0:W.source}}};var A,U,k;D.parameters={...D.parameters,docs:{...(A=D.parameters)==null?void 0:A.docs,source:{originalSource:`{
  args: {
    virtualListType: 'fixedHeight',
    listWidth: 400,
    listHeight: 600,
    // 实际高度
    itemHeight: 50,
    itemSumCount: 1000
  }
}`,...(k=(U=D.parameters)==null?void 0:U.docs)==null?void 0:k.source}}};var B,$,V;N.parameters={...N.parameters,docs:{...(B=N.parameters)==null?void 0:B.docs,source:{originalSource:`{
  args: {
    virtualListType: 'dynamicHeight',
    listWidth: 400,
    listHeight: 600,
    // 预测高度
    itemHeight: 50,
    itemSumCount: 1000
  }
}`,...(V=($=N.parameters)==null?void 0:$.docs)==null?void 0:V.source}}};const se=["UncertainHeight","FixedHeight","DynamicHeight"];export{N as DynamicHeight,D as FixedHeight,O as UncertainHeight,se as __namedExportsOrder,ie as default};
